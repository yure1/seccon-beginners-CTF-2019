# [Web] Ramen  
指定されたWebページの脆弱性をつく問題です。
ラメーン是非とも食したいところです。

問題URL：https://ramen.quals.beginners.seccon.jp/  
6月前半まで。
*技術用語：SQL、SQLインジェクション*

## 解答例  
1. SQLの扱いについて、脆弱な検索窓を見つける。
1. DBの種類が、MySQLだろうと、あたりをつける。
1. Mysqlデータベースに登録されているテーブル名を取得し、flagと書かれたテーブルを発見する。  
-- の後ろに空白を忘れないように。
~~~
' union select null, table_name from INFORMATION_SCHEMA.COLUMNS; -- 
~~~
4. テーブルflagのカラム名を取得する。
~~~
' union select null, COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS where TABLE_NAME = "flag"; -- 
~~~
5. select文を用いて、出力してflag取得。
~~~
' union select null, flag from flag; -- 
~~~

## 詳細
### 0. この問題について
背景のラーメンの写真が、頗るおいしそうな問題。  
真ん中にあるSQLについて配慮されていない検索窓があるので、そこから悪さをしていきます。  

### 1. SQLの扱いについて、脆弱な検索窓を見つける。
ラーメン屋さんのサイトです。とりあえず、眺めていると真ん中ほどに検索窓があります。  
usernameとぼんやり書かれているので、usernameと打ってみます。  
すると、下に書いてあった店員さんのコメントがなくなってしまいました…。  
次に、せくこん太郎を打ってみますと、一人だけのコメントが出てきました。  
どうやら、どこからか情報を引っ張ってきている模様。  

次に、DBとやり取りしている可能性を考えて、`'`を打ってみます。
すると、phpのエラー文が出てきました。  
つまり、`'`は意味のある文字であることがわかります。  
次にDBの利用を確認するため、以下のSQL文を打ち込んでみます。
~~~
' OR 1 = 1; -- 
~~~
名前を打っていないのに、店員すべてのコメントが出てきました。  
よって、このWebサイトはSQL文の扱いについて、脆弱性を抱えることがわかります。  
flagを取得するために、SQLインジェクションを試してみます。

#### 1-1. SQLインジェクション脆弱性
`'`などSQL文において意味のある文字を適切に処理することを怠った、などにより抱える脆弱性です。  
意図しないSQL文を実行され、情報の窃取や改ざんが行われる恐れがあります。  
今回のWebページの場合、店員のコメント検索の際、以下のようなSQL文が実行されていると思われます。
~~~
select [username], [コメントを示す列] from [テーブル] where username='検索窓からの値（例：せくこん太郎）';
~~~
`'`などが適切に処理されていないため、検索窓から`' OR 1=1; -- `のような文が与えられた際、弾くことができずSQL文の命令として実行されてしまいます。  
対処法としては、入力値を検証する、プレースホルダを用いる、などがあるそうです。  
ちなみに、`' OR 1=1; -- 'は、現在対象となっているテーブルの情報をすべて引っ張ってくる、という命令です。

### 2. DBの種類が、MySQLだろうと、あたりをつける。
DBを扱うことができるシステムは多数あります。  
大きくは統一されていますが、それぞれ特色があり、使用できる構文なども少し異なります。  
ただ、見分け方はわからないです…。  
現段階では、複数のSQL文を試して、ごり押ししています（笑）  

### 3～5. flag取得を目指す。
あたりを付けたMySQLで、flag取得を目指します。
`' OR 1=1; -- `で出るかな？と思ったのですが、甘くなかったです…。  
現在調査しているテーブル上には、先ほどのSQL文よりflagになりそうな行が見つかりませんでした。  
そこで、まず接続しているDBに登録されたテーブル名の一覧を、以下のように取得します。  
この時UNION命令を用いるので、取得するフィールドの数を一致させるようにします。  
今回ですと、2個です。
~~~
' union select null, table_name from INFORMATION_SCHEMA.COLUMNS; -- 
~~~
一覧を眺めると、テーブル名flagという如何にもな如何にもがでてくるので、今度はテーブル名flagの列名を取得します。
~~~
' union select null, COLUMN_NAME from INFORMATION_SCHEMA.COLUMNS where TABLE_NAME = "flag"; -- 
~~~
このテーブルは、列名flagのみでした。  
よって、select文を実行してflagを取得することができます。
~~~
' union select null, flag from flag; -- 
~~~
